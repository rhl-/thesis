\chapter{Mayer Vietoris \& Homology}
Any parallel computation of homology would require a decomposition of the
space into pieces. So far we discussed a way of computing homology from a 
nested sequence of inclusions. While this procedure is straightforward in theory, it can suffer it practice
because it potentially requires communication between all pairs of processors. To address this
we aim to decompose our input space input space into pieces using a \emph{cover}. Again in this setting, 
there is classical theory which explains how and when one can reconstruct the homology of a space
from the elements of a cover and there intersections. In the case of a cover by two sets this is referred to as
the \mv long exact sequence. When there are more than two sets in the cover, 
there is too much algebraic data to form a long exact sequence. 
In the case of a cover with three or more elements, the \mv spectral sequence expresses 
the relationship between the homology of these pieces of a space and the homology of the space itself.
This makes the \mv spectral sequence a natural gadget to study when developing algorithms for parallel homology~\cite{hatcher}. 

In this chapter we design and implement a framework for the parallel computation of field homology using the \mv principle. In the next section we describe the Mayer Vietoris Spectral Sequence. We then discuss the a topological analogue, on the input to this spectral sequence the \mvb{}.  
The \mvb{} is used by Zomorodian and Carlsson to compute localized homology~\cite{zc-lh-08}.  The procedures discussed in this section 
are a framework, in the sense that we provide an algorithm, which takes as input a cover. Any cover may be used with this algorithm,
and the results will be identical, with the only observable difference being the running time and space usage. 

We then present a simplistic model for the problem of finding covers which will lend themselves to parallelism and show that finding such covers is \NPH{}.
We describe an algorithm for producing covers with a simple structure and bounded overlap based on graph partitions. This approach allows
us to avoid the explicit construction of the blowup complex saving time and space. We implement our algorithms for multicore computers, 
and demonstrate their efficacy with a suite of experiments.  For example, we achieve roughly an 8$\times$ 
speedup of the homology computations on a 3-dimensional complex with about 10 million simplices using 11 cores.

\section{Mayer Vietoris Spectral Sequence}
\begin{figure}[h]
\centering
\begin{tikzcd}[scale=1,
execute at end scope={\begin{pgfonlayer}{edges}
\node[xshift=-1em,yshift=.5em] (c2) at (e20.north west) {\footnotesize$C_2\left(\K^{\C}\right)$};
\node[xshift=-1em,yshift=.5em] (c1) at (e10.north west) {\footnotesize$C_1\left(\K^{\C}\right)$};
\node[xshift=-1em,yshift=.5em] (c0) at (e00.north west) {\footnotesize$C_0\left(\K^{\C}\right)$};
\draw[opacity=.5,line width=7mm,line cap=round,color=afrablue] (e20.center) to (e02.center); 
\draw[opacity=.5,line width=7mm,line cap=round,color=afragreen] (e10.center) to (e01.center); 
\draw[opacity=.5,line width=7mm,line cap=round,color=afrapurple] (e00.center) to (e00.center);
\end{pgfonlayer} 
 }]
|[alias=e30]|  \vdots \arrow{d}{\partial_{\K}}& |[alias=e31]| \vdots \arrow{d}{\partial_{\K}}& |[alias=e32]| \vdots \arrow{d}{\partial_{\K}} \\
|[alias=e20]|E^0_{2,0}  \arrow{d}{\partial_{\K}}                     &  |[alias=e21]| E^0_{2,1} \arrow{l}{\partial_{\N}} \arrow{d}{\partial_{\K}}&|[alias=e22]|  E^0_{2,2} \arrow{l}{\partial_{\N}}  \arrow{d}{\partial_{\K}}& \ldots \arrow{l}{\partial_{\N}} \\
|[alias=e10]|E^0_{1,0} \arrow{d}{\partial_{\K}}                     & |[alias=e11]| E^0_{1,1} \arrow{l}{\partial_{\N}}  \arrow{d}{\partial_{\K}}& |[alias=e12]| E^0_{1,2} \arrow{l}{\partial_{\N}} \arrow{d}{\partial_{\K}}& \ldots \arrow{l}{\partial_{\N}} \\
|[alias=e00]|E^0_{0,0}                                      & |[alias=e01]| E^0_{0,1} \arrow{l}{\partial_{\N}}                & |[alias=e02]| E^0_{0,2} \arrow{l}{\partial_{\N}}                   & \ldots \arrow{l}{\partial_{\N}} 
\end{tikzcd}
\caption{The $E_0$ page of the Mayer Vietoris Double Complex. The term $E^0_{i,j}$ is the vector space generated by the $i$-dimensional cells in a $j$-fold intersection. Horizontal maps correspond to taking the nerve boundary, vertical maps correspond to the boundary of the base complex. The cells of dimension $p$ in the blowup complex are found on the anti-diagonal defined by $i+j = p$.}
\end{figure}
Recall, that a spectral sequence is a sequence of chain complexes $(E^r, d^r)$ called pages, where the terms of $E^{r+1}$ is composed of the homology on the previous page. This is an example of a spectral sequence of a double complex. In the context of a double complex, we have more algebraic data on each page. In particular, If we have a simplicial complex $\K$ with cover $\C$, then we have $E^r = \bigoplus_{p,q} E^r_{p,q}$ where $E^0_{p,q}$ is the vector space generated by cells of the form $\sigma \otimes \tau$ where $\sigma \in \K$ and $\tau \in N(\C)$ and $\dim{\sigma} = p$ and $\dim{\tau} = q$. 
We may define a differential $d^0: E^0_{p,q} \rightarrow E^0_{p-1,q}$ given by $d^0: \sigma \otimes \tau \rightarrow \partial_\K(\sigma) \otimes \tau$, making $(E^0, d^0)$ the first iterate in our spectral sequence. As usual, the homology of the $d^0$ differential provides the terms of the $E^1$ page. Unsurprisingly, the next differential, $d^1$ will be defined similarly, in terms of the right factor and $\partial_N$, the boundary on the nerve of the cover. This provides us with the $E^2$ page of the spectral sequence. Observe that by swapping the roles of $p$ and $q$ we produce a different spectral sequence.
Before describing this map, observe that we have two different filtrations of vector spaces which we may construct from this data: 
\begin{enumerate}
\item $\tilde{E}_k = \bigoplus_{p, q \leq k} E^0_{p,q}$
\item $\tilde{E}_k = \bigoplus_{p \leq k, q} E^0_{p,q}$ 
\end{enumerate}
Each of these filtrations of vector spaces gives rise to a spectral sequence as defined in the previous chapter, where $d^0 + (-1)^{p+q}d^1$ and $d^1 + (-1)^{p+q}d^0$ is the boundary operator. One can show that these spectral sequences have the same $E_\infty$ page~\cite{mcleary}. However, it is not difficult to produce an example where these filtrations produce distinct persistent homology modules. Consider for instance, the space and associated cover in Figure~\ref{fig:vignette}. 

Returning the spectral sequence of the double complex, The $d^r$ differential has the following signature $d^r_{p,q}: E^r_{p,q} \rightarrow E^r_{p+r-1, q-r}$. The map $d^r_{p,q}$ is defined as the restriction of the differential $r$ to elements in $E^r_{p,q}$. 

Recall that a spectral sequence stabilizes when $d^r_{*,*} = 0$. In this case, we have that the data in position $E^\infty_{i,j}$ is a summand of the homology in dimension $i+j$. 
\begin{figure}
\centering
\begin{tikzpicture}
\shade[ball color=afrablue,opacity=1] (1,0) circle (1cm);
\shade[ball color=afragreen,opacity=1] (0cm,0)  arc (180:90:1cm and 1cm) arc (0:90:0cm and -1cm) ;
\shade[ball color=afrapurple,opacity=1] (2cm,0)  arc (180:90:-1cm and 1cm) arc (0:90:0cm and -1cm) ;
\end{tikzpicture}
\caption{$S^2$ TODO: Fix this ugliness}
%adapt this: http://www.texample.net/tikz/examples/spherical-and-cartesian-grids/
\label{fig:S2-triangulation}
\end{figure}
We now provide a number of examples of the spectral sequence computed by hand.
\begin{example}
First, consider the cover of $S^2$ given by its four hemispheres. Each of the four sets in the cover is contractible, four of the six pairwise intersections are copies of $D^1$, and two of them are copies of $S^0$. Additionally, there are three triple intersections, each of which are a point. There are no four way intersection. Using the triangulation shown in Figure~\ref{fig:S2-triangulation} we get the an $E_0$ page with vectors spaces of the specified ranks:
\[ \begin{tikzcd}
0    &  0     &   0   \\
4    & \arrow{l}  6     & \arrow{l}   4
\end{tikzcd} \]
Of course, in this example the $E_1$ page is the same.
Passing to the $E_2$ page we compute the homology of the maps induced by chains on the nerve of the cover. The the map $d^2_{0,1}$ has rank 3, and it has a kernel of dimension 3. The map $d^2_{1,1}$ has rank 3 and a kernel of rank $1$.
\[ \begin{tikzcd}
0    &  0     &   0   \\
1    &  0     &   1
\end{tikzcd} \]
\end{example}

In an attempt to make a more complex example, that is one in which $d_2$ is non-trivial we will cover the 3-sphere.
\begin{example}
As a second example, consider the space $S^1 \star S^1 \sim S^3$ which is covered by three sets. Each element in the set is a copy of $D^1 \star S^1$, where $D^1 \subset S^1$ and each copy of $D^1$ intersects with another on a point. Notice that each of the individual sets, as well as pairwise intersections is contractible. The only three way intersection is a copy of $S^1$. The $E_1$ page is as follows:
\[ \begin{tikzcd}
0    &  0     &   1   \\
3    & \arrow{l} 3     & \arrow{l}   1
\end{tikzcd} \]
Once again, by the $E_2$ page the spectral sequence has stabilized.
\[  \begin{tikzcd}
0    &  0     &   1   \\
1    &  0     &   0
\end{tikzcd}
\]
Which produces the homology of $S^3$.
\end{example}
It is initially difficult to produce example spaces where even $d^2_{p,q}$ is nontrivial. One challenge is that a necessary condition for $d^2_{p,q}$ to be nonzero is that $E_{p,q}$ and $E^r_{p+r-1, q-r}$ must be nonzero. That is we need to have enough nontrivial homology in dimension at least one within the disjoint union, as well as nontrivial homology in an intersection of at least three sets. 

To introduce this example we first introduce the Hopf map. The Hopf map was written about in 1931 by Heinz Hopf~\cite{hopf}, and it is the smallest example of a continuous map $h : S^n \rightarrow S^m$ for $n > m$ which is not null-homotopic. The Hopf map is an example of a \emph{fibration}.
\begin{definition}
A map $\pi: E \rightarrow B$ is a \emph{fibration} if it satisfies the \emph{homotopy lifiting property},
that is, if there exists a map $\tilde{f}$ making this diagram commute:
\[ \begin{tikzcd}[column sep=1in,row sep=1in]
X \arrow{d}{X \times \{0\}} \arrow{r}{\tilde{f}_0} & E \arrow{d}{\pi} \\
X \times I  \arrow{r}{f} \arrow[dotted]{ur}{\tilde{f}} & B
\end{tikzcd} \]
Whenever $f$ is a homotopy. $\tilde{f}_0$ is any map such that $f_0 = \pi \circ \tilde{f}_0$ where $f_0 = \restr{f}{X \times \{0\}}$.
\end{definition}	

The hopf map is a map between $h: S^3 \rightarrow S^2$ whose fiber is $S^1$. That is, by the homotopy lifting property $h^{-1}(U) \simeq U \times S^1$. 
\begin{example}
We now revisit our original example, where we covered the $S^2$ by four sets. We turn the cover of $S^2$ into a cover of $S^3$, by considering the inverse image of each set under the hopf map. Now each of the four sets in the cover are homotopic to $S^1 \times D^2$, a solid tori. The pairwise intersections, are become four copies of $S^1 \times D^1$, and two copies of $S^1 \times S^0$. Each three way intersection is homotopic to $S^1$.
This produces the following $E_1$ page:
\[ \begin{tikzcd}
4    &  \arrow{l} 6     & \arrow{l}   4   \\
4    & \arrow{l}  6     & \arrow{l}   4
\end{tikzcd} \]
The $E_2$ page then has the following data
\[
\begin{tikzcd}
1    &  0     &   1   \\
1   &  0     &   \arrow{llu}1
\end{tikzcd} 
\]
This produces a single nonzero $d^2$ differential $d^2_{0,2}: E^2_{0,2} \rightarrow E^2_{1,0}$.
The spectral sequence then stabilizes on the third page $E_3 = E_\infty$.
\[
\begin{tikzcd}
0    &  0     &   1   \\
1   &  0     &    0
\end{tikzcd} 
\]
\end{example}

In the next section we provide another way of studying the mayer vietoris spectral sequence via its total complex. 